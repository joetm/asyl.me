define(["config","data","map","domReady","tpl","helpers","panels","happiness","minmax"],function(e,p,r,o,t,a,i,n,s){"use strict";var l="app:";o(function(r){$("#loader").addClass("done"),$.when(n,s,p.allresolved).done(function(p,r,o){for(var i={},n=Object.keys(p),s=0,d=n.length;d>s;s++)i[n[s]]=100-p[n[s]].Score/r.max*100;console.log(l+"shades",i);var m=L.geoJson(o.countries,{onEachFeature:function(p,n){p.properties.happiness=a.get_happiness(p.properties.name,o.happiness),p.properties.gdp=a.get_property(p.properties.name,o.gdp,"IntDollar"),p.properties.population=a.get_property(p.properties.name,o.population,"Population"),p.properties.area=a.get_property(p.properties.name,o.areas,"Land"),p.properties.center=a.get_properties(p.properties.name,o.centroids,["LAT","LONG"]),p.properties.ppa=0,p.properties.area>0&&(p.properties.population||(p.properties.population=0),p.properties.ppa=p.properties.population/p.properties.area),n.setStyle(e.defaultStyle),void 0!==i[p.properties.name]&&n.setStyle({fillColor:"hsl(66, 22%, "+(10*r.max-i[p.properties.name])+"%)"}),n.on("click",function(e){t.info_detail._container.innerHTML=t.info_detailTpl({name:this.feature.properties.name,happiness:p.properties.happiness,population:p.properties.population.formatNumber(),area:p.properties.area.formatNumber(),ppa:p.properties.ppa.toFixed(2),gdp:p.properties.gdp.formatNumber()}),t.info_panel._container.innerHTML=t.info_panelTpl({name:this.feature.properties.name}),m.eachLayer(function(e){m.resetStyle(e)});var r=e.target;r.setStyle({fillOpacity:.2}),L.DomUtil.removeClass(t.info_detail._container,"hidden")})}});e.overlayMaps["Happiness Score"]=m})})});